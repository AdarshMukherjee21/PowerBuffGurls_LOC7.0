<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGO Matching</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="ngo-info">
        <!-- This is where the NGO details will be displayed -->
    </div>
    <div id="csr-score">
        <!-- CSR score will be displayed here -->
    </div>
    <div id="partnership-insights">
        <!-- Insights will be displayed after a delay -->
    </div>

    <button id="like">Like</button>
    <button id="skip">Skip</button>

    <script>
        function loadNextNGO() {
            console.log("Loading next NGO...");
            $.get("/next_ngo", function(data) {
                console.log("Data received from /next_ngo:", data);  // Debugging the response

                if (data.status === "done") {
                    $("#ngo-info").html("<p>No more matches available.</p>");
                    $("#like, #skip").hide();
                    console.log("No more matches available.");
                } else {
                    // Show basic NGO information immediately
                    $("#ngo-info").html(`
                        <h2>${data.ngo.ngo_name}</h2>
                        <p>Location: ${data.ngo.locality}</p>
                        <p>Causes: ${data.ngo.causes}</p>
                    `);
                    $("#csr-score").text(data.score.toFixed(2));  // Display CSR score
                    console.log("CSR score displayed:", data.score.toFixed(2));

                    // Simulate a delay (e.g., 5 seconds) for the insights
                    setTimeout(function() {
                        $("#partnership-insights").text(data.insights);  // Display partnership insights
                        console.log("Insights displayed:", data.insights);  // Debugging insights
                    }, 5000);  // 5 seconds delay for insights
                }
            }).fail(function(xhr, status, error) {
                console.error("AJAX request failed:", status, error);  // Log if the AJAX request fails
            });
        }

        // Like or skip functionality
        $("#like").click(function() {
            let company_email = sessionStorage.getItem("company_email");
            let ngoEmail = "ngo1@example.com";  // Update dynamically if needed

            if (!company_email) {
                console.error("Company is not logged in!");
                return;
            }

            $.ajax({
                url: "/like_ngo",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    company_email: company_email,
                    ngo_email: ngoEmail
                }),
                success: function(response) {
                    console.log("Success:", response);  // Log success response
                    loadNextNGO();  // Load the next NGO after liking
                },
                error: function(xhr, status, error) {
                    console.error("Error:", xhr.responseText);  // Log error if request fails
                }
            });
        });

        $("#skip").click(function() {
            console.log("Skipping NGO...");
            loadNextNGO();
        });

        $(document).ready(function() {
            console.log("Document ready. Loading next NGO...");
            loadNextNGO();  // Call to load the first NGO
        });
    </script>
</body>
</html>
